<?xml version="1.0" encoding="utf-8"?>
<templates>
  <template type="admin" title="widget_def_options_et_event_timer" version_id="1000070" version_string="1.0.0"><![CDATA[<hr class="formRowSep" />

<xf:textboxrow name="options[description]" label="{{ phrase('sxf_et_event_description') }}" 
	value="{$options.description}" 
	explain="{{ phrase('sxf_et_event_description_explain') }}" />
<xf:textboxrow name="options[end_message]" label="{{ phrase('sxf_et_end_event_message') }}" 
	value="{$options.end_message}"
	explain="{{ phrase('sxf_et_end_event_message_explain') }}" />
<xf:dateinputrow name="options[end]" label="{{ phrase('sxf_et_event_end') }}" value="{$options.end}" />
<xf:checkboxrow>
	<xf:option name="options[hide]" label="{{ phrase('sxf_et_hide_end_event:') }}" checked="{$options.hide}">
		<xf:dependent>
			<xf:numberbox name="options[hide_time]" value="{$options.hide_time}" min="0" />
		</xf:dependent>
	</xf:option>
</xf:checkboxrow>

<hr class="formRowSep" />

<xf:textboxrow name="options[timer_color]" label="{{ phrase('sxf_et_timer_color') }}" 
	value="{$options.timer_color}" />
<xf:textboxrow name="options[background_color]" label="{{ phrase('sxf_et_background_color') }}" 
	value="{$options.background_color}" />
<xf:textboxrow name="options[background_image]" label="{{ phrase('sxf_et_background_image') }}" 
	value="{$options.background_image}"
	explain="{{ phrase('sxf_et_background_image_explain') }}" />]]></template>
  <template type="public" title="widget_sxf_et_eventTimer" version_id="1000070" version_string="1.0.0"><![CDATA[<xf:css src="widget_sxf_et_eventTimer.less" />
<div class="block">
	<div class="block-container">
		<div class="block-body et" 
			style="{{ $background_color ? 'background-color:' . $background_color . ';' : ''}}
				   {{ $background_image ? 'background:url(' . $background_image . ')  0 no-repeat/cover;' : ''}}">
			<div class="block-row description">
				{$description|raw}
			</div>
			<div class="block-row timer">
				<div id="timer" end-time="{$end_time}"
					 style="{{ $timer_color ? 'color:' . $timer_color . ';' : ''}}"></div>
				
				<script type="text/javascript">
					(function(){
						let echo = document.getElementById('timer'),
							fnDisplayTime = function(d, h, m, s)
							{
								echo.innerText = `${d} {{ phrase('units_days') }} \n${h} {{ phrase('units_hours') }} ${m} {{ phrase('units_minutes') }} ${s} {{ phrase('units_seconds') }}`;
							},
							fnEndTimer = function(msg)
							{
								echo.innerHTML = msg;
								clearTimeout(timer);
							},
							endTime = Math.floor(echo.getAttribute('end-time')),
							timer = setInterval(()=>{
								if (endTime < 0)
								{
									fnEndTimer('{$end_message|raw}');
									return;
								}
								
								let s = endTime, m = s/60, h = m/60, d = h/24;

								h = (d - Math.floor(d)) * 24;
								m = (h - Math.floor(h)) * 60;
								s = (m - Math.floor(m)) * 60;
								
								let t = [d,h,m,s].map(a=>Math.floor(a));
								
								fnDisplayTime(t[0],t[1],t[2],t[3]);
								
								endTime--;
							}, 1000);	
					})();
				</script>
			</div>
		</div>
	</div>
</div>]]></template>
  <template type="public" title="widget_sxf_et_eventTimer.less" version_id="1000070" version_string="1.0.0"><![CDATA[.et {
	.description {
		text-align: center;
		font-size: 16px;
	}
	.timer {
    	color: #5050f1;
   		font-weight: 600;
		text-align: center;
	}
}]]></template>
</templates>
